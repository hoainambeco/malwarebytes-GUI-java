package gui;

import javax.swing.*;
import java.awt.event.*;
import java.sql.*;

public class Login extends JFrame {
    private JPanel main;
    private JTextField txtUsername;
    private JPasswordField txtPassword;
    private JButton btnLogin;
    private JButton btnExit;
    private JButton btnSignUp;
    private static final JFrame frame = new JFrame();

    public Login() {
        btnLogin.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                actionLogin();
            }
        });
        btnExit.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                System.exit(0);
            }
        });
        txtUsername.addKeyListener(new KeyAdapter() {
            @Override
            public void keyPressed(KeyEvent e) {
                if (e.getKeyCode() == KeyEvent.VK_ENTER) {
                    actionLogin();
                }
                super.keyPressed(e);
            }
        });
        txtPassword.addKeyListener(new KeyAdapter() {
            @Override
            public void keyPressed(KeyEvent e) {
                if (e.getKeyCode() == KeyEvent.VK_ENTER) {
                    actionLogin();
                }
                super.keyPressed(e);
            }
        });
        btnSignUp.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                frame.dispose();
                signUp.signUpMain();
            }
        });
    }

    private void actionLogin() {
        String username = txtUsername.getText();
        String password = new String(txtPassword.getPassword());
        try {
            Statement statement = ConnectDB.connection.createStatement();
            ResultSet resultSet = statement.executeQuery("SELECT * FROM users WHERE username = '" + username + "' AND password = '" + password + "'");
            if (resultSet.next()) {
                frame.dispose();
                new Home().main( resultSet.getInt("id"));
            } else {
                JOptionPane.showMessageDialog(Login.this, "Invalid username or password.");
            }
            resultSet.close();
            statement.close();
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(Login.this, "Failed to retrieve data.");
        }
    }
    public static void loginMain() {
        frame.setTitle("Login");
        frame.setSize(600, 200);
        JPanel page = new JPanel();
        page.setSize(400, 400);
        frame.setResizable(false);
        frame.setContentPane(new Login().main);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setVisible(true);
        frame.setLocationRelativeTo(null);
        SwingUtilities.invokeLater(Login::new);
    }
}
