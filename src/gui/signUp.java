package gui;

import gui.DAO.UserDAO;
import gui.Interface.UserInterface;
import gui.entities.User;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Date;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JTextField;
import javax.swing.SwingUtilities;

public class signUp {

  private static final JFrame frame = new JFrame();
  UserInterface IUser = new UserDAO();
  private JPanel main;
  private JTextField txtUsername;
  private JTextField txtEmail;
  private JPasswordField txtPassword;
  private JPasswordField txtRePassword;
  private JButton btnSignUp;
  private JButton btnLogin;

  public signUp() {
    btnLogin.addActionListener(new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
        frame.dispose();
        Login.loginMain();
      }
    });
    btnSignUp.addActionListener(new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
        String username = txtUsername.getText();
        String email = txtEmail.getText();
        String password = String.valueOf(txtPassword.getPassword());
        String rePassword = String.valueOf(txtRePassword.getPassword());
        if (username.isEmpty() || email.isEmpty() || password.isEmpty() || rePassword.isEmpty()) {
          JOptionPane.showMessageDialog(null, "Please fill in all fields.");
        } else if (!password.equals(rePassword)) {
          JOptionPane.showMessageDialog(null, "Password does not match.");
        } else if (!email.matches("^(.+)@(.+)$")) {
          JOptionPane.showMessageDialog(null, "Email is invalid.");
        } else if (IUser.getUserByUsername(username) != null) {
          JOptionPane.showMessageDialog(null, "Username already exists.");
        } else if (IUser.getUserByEmail(email) != null) {
          JOptionPane.showMessageDialog(null, "Email already exists.");
        } else {
          IUser.addUser(new User(new Date(), new Date(), 0, username, email, password, "ACTIVE"));
          JOptionPane.showMessageDialog(null, "Sign up successfully.");
          frame.dispose();
          Login.loginMain();
        }
      }
    });
  }

  public static void signUpMain() {
    frame.setTitle("Login");
    frame.setSize(500, 300);
    frame.setResizable(false);
    frame.setContentPane(new signUp().main);
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setVisible(true);
    frame.setLocationRelativeTo(null);
    SwingUtilities.invokeLater(Login::new);
  }
}
